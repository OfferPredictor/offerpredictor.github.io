<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>美本申请规划方案</title>
    <script src="https://cdn.dhtmlx.com/gantt/7.1/dhtmlxgantt.js"></script>
    <link href="https://cdn.dhtmlx.com/gantt/7.1/dhtmlxgantt.css" rel="stylesheet">
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background-color: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
            min-height: 600px;
        }
        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 30px;
        }
        .back-button {
            display: inline-block;
            margin-top: 20px;
            padding: 10px 20px;
            background-color: #666;
            color: white;
            text-decoration: none;
            border-radius: 4px;
        }
        .back-button:hover {
            background-color: #555;
        }
        button {
            background-color: #4CAF50;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            margin-right: 10px;
        }
        button:hover {
            background-color: #45a049;
        }
        .gantt-controls {
            margin: 20px 0;
        }
        .event-type {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 3px;
            color: white;
            font-size: 12px;
            margin-right: 5px;
        }
        .event-type.waiting {
            background-color: #FFA500;
        }
        .event-type.ongoing {
            background-color: #4CAF50;
        }
        .event-type.completed {
            background-color: #2196F3;
        }
        #gantt {
            width: 100%;
            height: 400px;
        }
        /* 甘特图任务样式 */
        .gantt_task_line.waiting {
            background-color: #FFA500;
            border-color: #FF8C00;
        }
        .gantt_task_line.ongoing {
            background-color: #4CAF50;
            border-color: #388E3C;
        }
        .gantt_task_line.completed {
            background-color: #2196F3;
            border-color: #1976D2;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>美本申请规划方案</h1>
        <div class="gantt-controls">
            <button onclick="addTask()">添加事项</button>
            <button onclick="removeTask()">删除事项</button>
            <div style="margin-top: 10px;">
                <span class="event-type waiting">待办事项</span>
                <span class="event-type ongoing">进行中</span>
                <span class="event-type completed">已完成</span>
            </div>
        </div>
        <div id="gantt"></div>
        <a href="index.html" class="back-button">返回首页</a>
    </div>

    <script>
        // 基础配置
        gantt.config.date_format = "%Y-%m-%d";
        gantt.config.scale_unit = "month";
        gantt.config.step = 1;

        // 设置时间范围为2024年
        gantt.config.start_date = new Date(2024, 0, 1);
        gantt.config.end_date = new Date(2024, 11, 31);

        // 初始化甘特图
        gantt.init("gantt");

        // 初始化数据
        const data = {
            data: [
                {id: 1, text: "托福考试", start_date: "2024-01-01", end_date: "2024-03-31"},
                {id: 2, text: "SAT考试", start_date: "2024-04-01", end_date: "2024-06-30"},
                {id: 3, text: "准备申请", start_date: "2024-07-01", end_date: "2024-12-31"}
            ]
        };

        gantt.parse(data);

        // 添加任务
        function addTask() {
            const taskText = prompt("请输入计划事项名称：");
            if (!taskText) return;

            const startDate = prompt("请输入开始时间（2024年的日期，格式：YYYY-MM-DD）：");
            if (!startDate || !isValidDate(startDate) || new Date(startDate).getFullYear() !== 2024) {
                alert("请输入2024年的有效日期（YYYY-MM-DD格式）");
                return;
            }

            const endDate = prompt("请输入结束时间（2024年的日期，格式：YYYY-MM-DD）：");
            if (!endDate || !isValidDate(endDate) || new Date(endDate).getFullYear() !== 2024) {
                alert("请输入2024年的有效日期（YYYY-MM-DD格式）");
                return;
            }

            if (new Date(endDate) < new Date(startDate)) {
                alert("结束日期不能早于开始日期");
                return;
            }

            const newId = gantt.getTaskByTime().reduce((max, task) => Math.max(max, task.id), 0) + 1;
            gantt.addTask({
                id: newId,
                text: taskText,
                start_date: startDate,
                end_date: endDate,
                status: "waiting",
                progress: 0
            });
        }

        // 删除任务
        function removeTask() {
            const selectedId = gantt.getSelectedId();
            if (selectedId) {
                if (confirm("确定要删除这个计划事项吗？")) {
                    gantt.deleteTask(selectedId);
                }
            } else {
                alert("请先选择要删除的计划事项");
            }
        }

        // 双击任务切换状态
        gantt.attachEvent("onTaskDblClick", function(id, e) {
            const task = gantt.getTask(id);
            if (task.status === "waiting") {
                task.status = "ongoing";
                task.progress = 50;
            } else if (task.status === "ongoing") {
                task.status = "completed";
                task.progress = 100;
            } else {
                task.status = "waiting";
                task.progress = 0;
            }
            gantt.updateTask(id);
            return true;
        });

        // 辅助函数：验证日期格式
        function isValidDate(dateString) {
            const regex = /^\d{4}-\d{2}-\d{2}$/;
            if (!regex.test(dateString)) return false;
            
            const date = new Date(dateString);
            if (!(date instanceof Date) || isNaN(date)) return false;
            
            const [year, month, day] = dateString.split('-').map(Number);
            return month >= 1 && month <= 12 && day >= 1 && day <= 31;
        }
    </script>
</body>
</html> 